<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Pre-Anesthesia Checklist (PAC)</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      background: #f0f0f0;
    }
    h2 {
      background-color: #004080;
      color: white;
      padding: 10px;
      border-radius: 5px;
    }
    .section {
      background: #fff;
      padding: 15px;
      margin-bottom: 20px;
      border-radius: 5px;
      box-shadow: 0 0 5px rgba(0,0,0,0.1);
    }
    label {
      display: block;
      margin-top: 10px;
      font-weight: bold;
    }
    textarea, input, select {
      width: 100%;
      padding: 6px;
      margin-top: 5px;
      border: 1px solid #ccc;
      border-radius: 4px;
    }
    .checkbox-group {
      margin-left: 20px;
    }
    .btn {
      background-color: #004080;
      color: white;
      padding: 10px 20px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      margin-top: 10px;
      margin-right: 10px;
    }
  </style>
</head>
<body>

  <h2>Pre-Anesthesia Checklist (PAC)</h2>

  <!-- ? Patient Details section -->
  <div class="section">
    <h3>Patient Details</h3>

    <label>Patient ID</label>
    <input type="text" name="patientId" required>

    <label>Full Name</label>
    <input type="text" name="name" required>

    <label>Age</label>
    <input type="number" name="age" required>

    <label>Gender</label>
    <select name="gender" required>
      <option value="">Select</option>
      <option value="Male">Male</option>
      <option value="Female">Female</option>
      <option value="Other">Other</option>
    </select>
  </div>

  <!-- ? Main Form -->
  <form id="pacForm">

    <div class="section">
      <h3>Medical History</h3>
      <label>Past surgeries and anesthesia history</label>
      <select name="surgeryHistory"><option>Choose an item...</option><option>No issues</option><option>Complications</option></select>
      <label>Remarks:</label>
      <textarea name="surgeryRemarks"></textarea>

      <label>Allergies</label>
      <select name="allergies"><option>Choose an item...</option><option>None</option><option>Yes</option></select>
      <label>Remarks:</label>
      <textarea name="allergyRemarks"></textarea>

      <label>Current Medications</label>
      <textarea name="medications"></textarea>

      <label>Chronic Illnesses:</label>
      <div class="checkbox-group">
        <label><input type="checkbox" name="illnesses" value="Hypertension"> Hypertension</label>
        <label><input type="checkbox" name="illnesses" value="Diabetes"> Diabetes</label>
        <label><input type="checkbox" name="illnesses" value="Asthma / COPD"> Asthma / COPD</label>
        <label><input type="checkbox" name="illnesses" value="Heart disease"> Heart disease</label>
        <label><input type="checkbox" name="illnesses" value="Kidney disease"> Kidney disease</label>
        <label><input type="checkbox" name="illnesses" value="Others"> Others: <input type="text" name="illnessOther" style="width: 50%;"></label>
      </div>
    </div>

    <!-- Additional form sections follow the same format -->
    <!-- Only changed section IDs/names where relevant -->

    <div class="section">
      <h3>Fit for Anesthesia?</h3>
      <div class="checkbox-group">
        <label><input type="radio" name="fit" value="Yes"> Yes – Proceed</label>
        <label><input type="radio" name="fit" value="No"> No – Needs further optimization</label>
        <label>Reason (if not fit):</label><textarea name="fitReason"></textarea>
      </div>
      <label>Anesthesiologist Name & Signature:</label>
      <input type="text" name="doctor">
      <label>Date & Time:</label>
      <input type="datetime-local" name="datetime">
    </div>

    <!-- ? Action Buttons -->
    <button type="button" class="btn" onclick="generatePDF()">?? Download as PDF</button>
    <button type="button" class="btn" onclick="savePatientData()">?? Save Patient Data</button>
    <button type="button" class="btn" onclick="loadPatientData()">?? Load Patient Data</button>

  </form>

<!-- ? Libraries -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<!-- ? JavaScript -->
<script>
  async function generatePDF() {
    const form = document.getElementById("pacForm");
    const canvas = await html2canvas(form, { scale: 2 });
    const imageData = canvas.toDataURL("image/png");

    const { jsPDF } = window.jspdf;
    const pdf = new jsPDF("p", "mm", "a4");
    const imgProps = pdf.getImageProperties(imageData);
    const pdfWidth = pdf.internal.pageSize.getWidth();
    const pdfHeight = (imgProps.height * pdfWidth) / imgProps.width;

    pdf.addImage(imageData, "PNG", 0, 0, pdfWidth, pdfHeight);
    pdf.save("pre-anesthesia-checklist.pdf");
  }

  function savePatientData() {
    const form = document.getElementById("pacForm");
    const formData = new FormData(form);
    const patientId = formData.get("patientId");

    if (!patientId) {
      alert("Please enter a Patient ID");
      return;
    }

    const data = {};
    formData.forEach((value, key) => {
      if (data[key]) {
        if (!Array.isArray(data[key])) data[key] = [data[key]];
        data[key].push(value);
      } else {
        data[key] = value;
      }
    });

    const existing = JSON.parse(localStorage.getItem("patients") || "{}");
    existing[patientId] = data;
    localStorage.setItem("patients", JSON.stringify(existing));
    alert("? Data saved for Patient ID: " + patientId);
  }

  function loadPatientData() {
    const patientId = prompt("Enter Patient ID to load:");
    if (!patientId) return;

    const patients = JSON.parse(localStorage.getItem("patients") || "{}");
    const data = patients[patientId];

    if (!data) {
      alert("? No data found for Patient ID: " + patientId);
      return;
    }

    const form = document.getElementById("pacForm");
    Object.keys(data).forEach(key => {
      const field = form.elements[key];
      if (!field) return;

      if (field.type === "checkbox" || field.type === "radio") {
        const fields = form.querySelectorAll(`[name="${key}"]`);
        fields.forEach(f => {
          f.checked = Array.isArray(data[key]) ? data[key].includes(f.value) : data[key] === f.value;
        });
      } else {
        field.value = data[key];
      }
    });
    alert("?? Loaded data for Patient ID: " + patientId);
  }
</script>

</body>
</html>
